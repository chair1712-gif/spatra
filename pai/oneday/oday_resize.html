  <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard Tahfidz Juz 30</title>

<style>
body{
font-family:'Segoe UI',sans-serif;
margin:0;
padding:20px;
background:#f4f6f9;
color:#333;
}

h2{
text-align:center;
margin-bottom:20px;
font-weight:600;
color:#2c3e50;
}

/* TAB */
.tab-container{
display:flex;
gap:8px;
margin-bottom:15px;
flex-wrap:wrap;
}

.tab-btn{
padding:6px 14px;
border:none;
border-radius:20px;
background:#e0e7ff;
cursor:pointer;
font-size:13px;
transition:0.3s;
}

.tab-btn:hover{
background:#c7d2fe;
}

.tab-btn.active{
background:#6366f1;
color:#fff;
font-weight:600;
}

/* WRAPPER */
.table-wrapper{
height:520px;
overflow:auto;
background:#ffffff;
border-radius:12px;
box-shadow:0 4px 12px rgba(0,0,0,0.08);
padding:10px;
}

/* TABLE */
table{
border-collapse:collapse;
width:max-content;
background:#fff;
}

th,td{
border:1px solid #e5e7eb;
padding:1px;
text-align:center;
font-size:11px;
white-space:nowrap;
}

td.nama{
text-align:left;
font-size:12px;
font-weight:500;
}

/* HEADER */
th{
background:#eef2ff;
color:#1e293b;
position:sticky;
top:0;
z-index:5;
font-weight:600;
}

/* HEADER SURAT VERTIKAL */
th.surat-header{
height:100px;
vertical-align:center;
padding:2;
background:#f1f5f9;
}

th.surat-header div{
transform:rotate(-90deg);
transform-origin:center;
white-space:nowrap;
width:18px;
font-size:11px;
font-weight:600;
}

/* PROGRESS */
.progress{
background:#e5e7eb;
height:8px;
border-radius:10px;
margin-top:4px;
overflow:hidden;
}

.bar{
background:#6366f1;
height:100%;
}

/* Hover Row */
tbody tr:hover{
background:#f9fafb;
transition:0.2s;
}
</style>
</head>
<body>

<h2>ðŸ“– Dashboard Tahfidz Juz 30</h2>

<div class="tab-container" id="tabContainer"></div>

<div class="table-wrapper">
<table id="tabel">
<thead>
<tr id="headerRow">
<th style="width:40px">No</th>
<th style="width:80px">Kelas</th>
<th style="width:160px">Nama</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
const sheetID="1bcg6d9_5LgcE1kEQw2iEGLJuv_789p-k4PbXHb1YRDg";

const juz30=[
"An-Naba","An-Nazi'at","Abasa","At-Takwir","Al-Infitar","Al-Mutaffifin",
"Al-Insyiqaq","Al-Buruj","At-Tariq","Al-A'la","Al-Ghasyiyah","Al-Fajr",
"Al-Balad","Asy-Syams","Al-Lail","Ad-Duha","Al-Insyirah","At-Tin",
"Al-Alac","Al-Qadr","Al-Bayyinah","Az-Zalzalah","Al-'Adiyat",
"Al-Qari'ah","At-Takatsur","Al-Asr","Al-Humazah","Al-Fil",
"Quraisy","Al-Ma'un","Al-Kautsar","Al-Kafirun","An-Nasr",
"Al-Lahab","Al-Ikhlas","Al-Falaq","An-Nas"
];

const suratReverse=[...juz30].reverse();
const query=encodeURIComponent("select A,B,F,H where A is not null");
const url=`https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?gid=0&tq=${query}`;

let globalData=[];
let currentKelas="";

fetch(url)
.then(res=>res.text())
.then(rep=>{
const json=JSON.parse(rep.substr(47).slice(0,-2));

json.table.rows.forEach(r=>{
let kelas=r.c[0]?.v||"";
let nama=r.c[1]?.v||"";
let hafalan=(r.c[2]?.v||"").split(",").map(s=>s.trim());
let tgl=formatTanggal(r.c[3]?.v);

let obj={kelas,nama,surat:{}};
hafalan.forEach(s=>{
if(juz30.includes(s)) obj.surat[s]=tgl;
});
globalData.push(obj);
});

buatHeader();
buatTabs();
});

/* Format tanggal dd/mm */
function formatTanggal(v){
if(!v) return "";
if(typeof v==="string" && v.startsWith("Date(")){
let a=v.match(/\d+/g);
return a[2]+"/"+(parseInt(a[1])+1);
}
return "";
}

/* Header */
function buatHeader(){
let row=document.getElementById("headerRow");

suratReverse.forEach(s=>{
let th=document.createElement("th");
th.className="surat-header";
let div=document.createElement("div");
div.innerText=s;
th.appendChild(div);
row.appendChild(th);
});

let thCap=document.createElement("th");
thCap.innerText="Pencapaian";
row.appendChild(thCap);
}

/* Tabs */
function buatTabs(){
let kelasUnik=[...new Set(globalData.map(d=>d.kelas))];

kelasUnik.sort((a,b)=>{
let na=parseInt(a.split("-")[1]);
let nb=parseInt(b.split("-")[1]);
return na-nb;
});

kelasUnik.forEach((k,i)=>{
let btn=document.createElement("button");
btn.className="tab-btn";
btn.innerText=k;
if(i===0){btn.classList.add("active");currentKelas=k}
btn.onclick=function(){
document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
btn.classList.add("active");
currentKelas=k;
tampilkan();
};
tabContainer.appendChild(btn);
});
tampilkan();
}

/* Tampilkan */
function tampilkan(){
let tbody=document.querySelector("#tabel tbody");
tbody.innerHTML="";

let data=globalData.filter(d=>d.kelas===currentKelas);
data.sort((a,b)=>a.nama.localeCompare(b.nama));

data.forEach((d,i)=>{
let total=Object.keys(d.surat).length;
let persen=Math.round((total/juz30.length)*100);

let tr=document.createElement("tr");

tr.innerHTML=`
<td>${i+1}</td>
<td>${d.kelas}</td>
<td class="nama">${d.nama}</td>
`;

suratReverse.forEach(s=>{
let td=document.createElement("td");
td.innerText=d.surat[s]||"";
tr.appendChild(td);
});

let tdCap=document.createElement("td");
tdCap.innerHTML=`
${total}/37
<div class="progress">
<div class="bar" style="width:${persen}%"></div>
</div>
${persen}%
`;
tr.appendChild(tdCap);

tbody.appendChild(tr);
});
}
</script>

</body>
</html>
