  <!DOCTYPE html>
<html>
<head>
  <title>Laporan Ramadhan</title>
  <style>
    body { font-family: Arial; margin:30px; }

    h2 { margin-bottom:5px; }

    .tanggal-box {
      margin-bottom:15px;
      font-size:14px;
    }

    .divider {
      border-top:2px solid #000;
      margin:10px 0;
    }

    .tabs {
      display:flex;
      flex-wrap:wrap;
      gap:5px;
      margin-bottom:10px;
    }

    .tab {
      padding:8px 15px;
      background:#eee;
      cursor:pointer;
      border-radius:4px;
      font-size:13px;
    }

    .tab:hover {
      background:#2e7d32;
      color:white;
    }

    .tab.active {
      background:#2e7d32;
      color:white;
    }

    table {
      border-collapse: collapse;
      width:100%;
      font-size:13px;
    }

    th, td {
      border:1px solid #ccc;
      padding:6px;
    }

    th {
      background:#2e7d32;
      color:white;
    }

  </style>
</head>
<body>

<h2>LAPORAN KEGIATAN RAMADHAN</h2>

<div class="tanggal-box">
  Tanggal :
  <input type="date" id="filterTanggal">
</div>

<div class="divider"></div>

<div class="tabs" id="tabs"></div>

<div class="divider"></div>

<div id="data"></div>

<script>
const spreadsheetId = "1bcg6d9_5LgcE1kEQw2iEGLJuv_789p-k4PbXHb1YRDg";
const sheetName = "Sheet1";

let kelasAktif = "";

/* ===== DEFAULT TANGGAL = HARI INI ===== */
function setToday(){
  const today = new Date();
  const yyyy = today.getFullYear();
  const mm = String(today.getMonth()+1).padStart(2,'0');
  const dd = String(today.getDate()).padStart(2,'0');
  document.getElementById("filterTanggal").value = `${yyyy}-${mm}-${dd}`;
}

/* ===== FORMAT KE dd/MM/yyyy ===== */
function formatTanggalIndonesia(dateValue){
  if(!dateValue) return "";
  const t = new Date(dateValue);
  const dd = String(t.getDate()).padStart(2,'0');
  const mm = String(t.getMonth()+1).padStart(2,'0');
  const yyyy = t.getFullYear();
  return `${dd}/${mm}/${yyyy}`;
}

/* ===== BUAT TAB KELAS ===== */
function buatTab(){
  const kelasList = [
    "XII-1","XII-2","XII-3","XII-4",
    "XII-5","XII-6","XII-7","XII-8","XII-9"
  ];

  const container = document.getElementById("tabs");

  kelasList.forEach(kelas=>{
    const tab = document.createElement("div");
    tab.className = "tab";
    tab.innerText = kelas;

    tab.onclick = ()=>{
      document.querySelectorAll(".tab")
        .forEach(t=>t.classList.remove("active"));

      tab.classList.add("active");
      kelasAktif = kelas;
      loadData();
    };

    container.appendChild(tab);
  });
}

/* ===== LOAD DATA ===== */
 function loadData(){
  if(!kelasAktif) return;

  const tanggalInput = document.getElementById("filterTanggal").value;
  if(!tanggalInput) return;

  const startDate = `${tanggalInput} 00:00:00`;
  const endDate   = `${tanggalInput} 23:59:59`;

  let query = `
    select * 
    where A='${kelasAktif}'
    and H >= datetime '${startDate}'
    and H <= datetime '${endDate}'
  `;

  const url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/gviz/tq?sheet=${sheetName}&tq=${encodeURIComponent(query)}`;

  fetch(url)
    .then(res=>res.text())
    .then(rep=>{
      const json = JSON.parse(rep.substring(47).slice(0,-2));
      tampilkanTabel(json);
    });
}


/* ===== TAMPILKAN TABEL ===== */
function tampilkanTabel(json){
  const rows = json.table.rows;

  if(rows.length === 0){
    document.getElementById("data").innerHTML =
      "<b>Tidak ada data pada tanggal ini.</b>";
    return;
  }

  let html = "<table><tr>";

  json.table.cols.forEach(col=>{
    html += `<th>${col.label}</th>`;
  });

  html += "</tr>";

  rows.forEach(r=>{
    html += "<tr>";
    r.c.forEach(c=>{
      html += `<td>${c ? c.v : ""}</td>`;
    });
    html += "</tr>";
  });

  html += "</table>";

  document.getElementById("data").innerHTML = html;
}

/* ===== INIT ===== */
setToday();
buatTab();

document.getElementById("filterTanggal")
  .addEventListener("change", loadData);

</script>

</body>
</html>
