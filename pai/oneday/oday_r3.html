  <!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Pivot JUZ - Google Sheet</title>

<style>
body{
    font-family: Arial;
    background:#f4f6f9;
    padding:20px;
}

h2{text-align:center;}

.tabs{
    display:flex;
    gap:5px;
    margin-bottom:15px;
    flex-wrap:wrap;
}

.tab-btn{
    padding:8px 15px;
    background:#3498db;
    color:white;
    border:none;
    cursor:pointer;
    border-radius:5px;
}

.tab-btn.active{
    background:#2c3e50;
}

table{
    width:100%;
    border-collapse:collapse;
    background:white;
}

th{
    background:#2c3e50;
    color:white;
    padding:8px;
    font-size:13px;
}

td{
    padding:8px;
    text-align:center;
    border-bottom:1px solid #ddd;
    font-size:13px;
}

tr:hover{background:#f1f1f1;}
</style>
</head>

<body>

<h2>PIVOT BACAAN BERDASARKAN JUZ (Google Sheet)</h2>

<div class="tabs" id="tabs"></div>
<div id="tableContainer"></div>

<script>

// ================== KONFIGURASI ==================
const sheetID = "1bcg6d9_5LgcE1kEQw2iEGLJuv_789p-k4PbXHb1YRDg";
const sheetName = "0";
const query = encodeURIComponent("select A,B,E,H where A is not null");
const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?gid=${sheetName}&tq=${query}`;

// ================== FETCH DATA ==================
fetch(url)
.then(res => res.text())
.then(rep => {

    const json = JSON.parse(rep.substring(47).slice(0,-2));
    const rows = json.table.rows;

    let pivot = {};

    rows.forEach(r => {

        let kelas = r.c[0]?.v || "";
        let nama  = r.c[1]?.v || "";
        let baca  = r.c[2]?.v || "";

        if(!baca.includes("Juz")) return;

        let parts = baca.split(":");
        let juz = parts[0].trim();            // contoh: Juz 3
        let ayat = parts[1]?.trim() || "";

        if(!pivot[juz]){
            pivot[juz] = {
                ayatList: new Set(),
                siswa: {}
            };
        }

        pivot[juz].ayatList.add(ayat);

        if(!pivot[juz].siswa[nama]){
            pivot[juz].siswa[nama] = new Set();
        }

        pivot[juz].siswa[nama].add(ayat);

    });

    renderTabs(pivot);
});

// ================== RENDER ==================

function renderTabs(pivot){

    const tabsDiv = document.getElementById("tabs");
    const tableContainer = document.getElementById("tableContainer");

    function renderTable(juz){

        let ayatArray = Array.from(pivot[juz].ayatList);

        let table = `
        <table>
            <thead>
                <tr>
                    <th>Nama Siswa</th>
        `;

        ayatArray.forEach(a=>{
            table += `<th>${a}</th>`;
        });

        table += "</tr></thead><tbody>";

        Object.keys(pivot[juz].siswa).sort().forEach(nama=>{

            table += `<tr><td>${nama}</td>`;

            ayatArray.forEach(a=>{
                if(pivot[juz].siswa[nama].has(a)){
                    table += `<td>âœ”</td>`;
                } else {
                    table += `<td>-</td>`;
                }
            });

            table += "</tr>";
        });

        table += "</tbody></table>";

        tableContainer.innerHTML = table;
    }

    Object.keys(pivot).sort((a,b)=>{
        return parseInt(a.replace("Juz","")) - parseInt(b.replace("Juz",""));
    }).forEach((juz,index)=>{

        let btn = document.createElement("button");
        btn.className = "tab-btn";
        btn.innerText = juz.toUpperCase();

        btn.onclick = function(){
            document.querySelectorAll(".tab-btn")
                .forEach(b=>b.classList.remove("active"));
            btn.classList.add("active");
            renderTable(juz);
        };

        tabsDiv.appendChild(btn);

        if(index === 0){
            btn.classList.add("active");
            renderTable(juz);
        }
    });
}

</script>

</body>
</html>
