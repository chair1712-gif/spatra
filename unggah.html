 <!DOCTYPE html>
<html>
<head>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>Upload Gambar</title>
</head>
<body style='font-family: Arial, sans-serif; max-width: 400px; margin: 20px auto; padding: 20px;'>
  <h2 style='text-align: center;'>Upload Gambar</h2>
  
  <form id='form' style='display: flex; flex-direction: column; gap: 10px;'>
    <input name='nama' placeholder='Nama' required style='padding: 10px;'>
    <input type='file' id='file' accept='image/*' required style='padding: 10px;'>
    <button type='submit' style='padding: 10px; background: #1976d2; color: white; border: none; cursor: pointer;'>Upload</button>
  </form>

  <p id='status' style='margin-top: 15px; text-align: center; font-weight: bold;'></p>

<script>
document.getElementById('form').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const status = document.getElementById('status');
  const file = document.getElementById('file').files[0];
  
  // Validasi file
  if (!file) {
    status.innerText = '❌ Pilih file gambar terlebih dahulu';
    status.style.color = '#d32f2f';
    return;
  }
  
  // Validasi tipe file
  if (!file.type.startsWith('image/')) {
    status.innerText = '❌ File harus berupa gambar (JPEG, PNG, dll)';
    status.style.color = '#d32f2f';
    return;
  }
  
  // Validasi nama
  const nama = e.target.nama.value.trim();
  if (!nama) {
    status.innerText = '❌ Nama harus diisi';
    status.style.color = '#d32f2f';
    return;
  }
  
  // Convert file ke base64
  status.innerText = '⏳ Mengkonversi file...';
  status.style.color = '#1976d2';
  
  try {
    const base64 = await fileToBase64(file);
    
    status.innerText = '⏳ Mengupload ke server...';
    
    // Ganti URL dengan URL deployment Anda
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbw-cjLYOMDpKSa74zD6TsW-B0XNEk6o6hUoBC6FSCJO0rDGZD3elDtE6rak_okpE9s/exec';
    
    const response = await fetch(scriptUrl, {
      method: 'POST',
      mode: 'no-cors', // Tambahkan ini untuk menghindari CORS
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        nama: nama,
        file: base64,
        filename: file.name,
        type: file.type,
        size: file.size,
        timestamp: new Date().toISOString()
      })
    });
    
    // Karena menggunakan no-cors, kita tidak bisa membaca response
    // Tapi kita anggap berhasil jika tidak ada error
    status.innerText = '✅ File berhasil dikirim! Cek Google Sheets.';
    status.style.color = '#2e7d32';
    e.target.reset();
    
  } catch (err) {
    console.error('Error:', err);
    status.innerText = '❌ Gagal upload: ' + err.message;
    status.style.color = '#d32f2f';
  }
});

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const base64String = reader.result.split(',')[1];
      if (!base64String) {
        reject(new Error('Gagal mengkonversi file ke base64'));
      } else {
        resolve(base64String);
      }
    };
    reader.onerror = () => reject(new Error('Gagal membaca file'));
    reader.readAsDataURL(file);
  });
}

// Alternatif: Jika fetch tidak bekerja, gunakan XMLHttpRequest
function uploadWithXHR(data) {
  return new Promise((resolve, reject) => {
    const xhr = new XMLHttpRequest();
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbw-cjLYOMDpKSa74zD6TsW-B0XNEk6o6hUoBC6FSCJO0rDGZD3elDtE6rak_okpE9s/exec';
    
    xhr.open('POST', scriptUrl);
    xhr.setRequestHeader('Content-Type', 'application/json');
    
    xhr.onload = () => {
      if (xhr.status === 200) {
        resolve(xhr.responseText);
      } else {
        reject(new Error('Request failed: ' + xhr.status));
      }
    };
    
    xhr.onerror = () => reject(new Error('Network error'));
    xhr.send(JSON.stringify(data));
  });
}
</script>
</body>
</html>
